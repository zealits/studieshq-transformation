# PayPal Integration Setup Guide

This guide will help you set up PayPal integration for the StudiesHQ platform to enable clients to add funds to their wallets.

## Prerequisites

1. PayPal Developer Account
2. PayPal Sandbox App created
3. Node.js and npm installed
4. MongoDB running

## 1. PayPal Developer Setup

### Step 1: Create PayPal Developer Account

1. Go to [PayPal Developer](https://developer.paypal.com/)
2. Sign in with your PayPal account or create a new one
3. Accept the developer agreement

### Step 2: Create a Sandbox Application

1. Navigate to "My Apps & Credentials"
2. Make sure you're on the "Sandbox" tab
3. Click "Create App"
4. Fill in the application details:
   - **App Name**: StudiesHQ Sandbox
   - **Merchant**: Select your sandbox business account (or create one)
   - **Features**: Check "Accept Payments"
5. Click "Create App"

### Step 3: Get Your Credentials

After creating the app, you'll see:

- **Client ID**: Copy this for your environment variables
- **Client Secret**: Copy this for your environment variables

## 2. Backend Configuration

### Step 1: Install Dependencies

The PayPal SDK has already been installed. If you need to reinstall:

```bash
cd backend
npm install @paypal/checkout-server-sdk
```

### Step 2: Environment Variables

Create a `.env` file in the backend directory:

```bash
cp env.example .env
```

Update the `.env` file with your PayPal credentials:

```env
# PayPal Configuration (Sandbox)
PAYPAL_CLIENT_ID=your_actual_sandbox_client_id_here
PAYPAL_CLIENT_SECRET=your_actual_sandbox_client_secret_here

# Other required variables
MONGODB_URI=mongodb://localhost:27017/studieshq
JWT_SECRET=your_jwt_secret_here
FRONTEND_URL=http://localhost:5173
PORT=5000
NODE_ENV=development
```

## 3. Frontend Configuration

### Step 1: Install Dependencies

The PayPal React SDK has already been installed. If you need to reinstall:

```bash
cd frontend
npm install @paypal/react-paypal-js
```

### Step 2: Environment Variables

Create a `.env` file in the frontend directory:

```bash
cp env.example .env
```

Update the `.env` file:

```env
# PayPal Configuration (Sandbox)
VITE_PAYPAL_CLIENT_ID=your_actual_sandbox_client_id_here

# API Base URL
VITE_API_URL=http://localhost:5000
```

## 4. Testing the Integration

### Step 1: Start the Development Servers

Backend:

```bash
cd backend
npm run dev
```

Frontend:

```bash
cd frontend
npm run dev
```

### Step 2: Test PayPal Payments

1. Log in as a client user
2. Navigate to the Payments page
3. Click "Add Funds"
4. Enter an amount (e.g., $10.00)
5. Select PayPal and click "Continue"
6. Use PayPal sandbox test credentials to complete payment

### PayPal Sandbox Test Accounts

PayPal provides test accounts for sandbox testing:

- **Personal Account (Buyer)**:
  - Email: sb-buyer@personal.example.com
  - Password: [generated by PayPal]
- **Business Account (Merchant)**:
  - Email: sb-merchant@business.example.com
  - Password: [generated by PayPal]

You can find these in your PayPal Developer Dashboard under "Sandbox" > "Accounts".

## 5. Production Setup

When ready for production:

### Step 1: Create Production App

1. In PayPal Developer Dashboard, switch to "Live" tab
2. Create a new app for production
3. Get production Client ID and Client Secret

### Step 2: Update Environment Variables

```env
NODE_ENV=production
PAYPAL_CLIENT_ID=your_production_client_id
PAYPAL_CLIENT_SECRET=your_production_client_secret
```

### Step 3: Update Frontend Environment

```env
VITE_PAYPAL_CLIENT_ID=your_production_client_id
```

## 6. Features Implemented

### Backend Features

- ✅ PayPal order creation
- ✅ Payment capture and verification
- ✅ Wallet balance updates
- ✅ Transaction recording
- ✅ Error handling and validation
- ✅ Security measures

### Frontend Features

- ✅ Add Funds modal
- ✅ PayPal payment integration
- ✅ Real-time wallet balance updates
- ✅ Payment status feedback
- ✅ Responsive design
- ✅ Error handling

### Security Features

- ✅ Server-side payment verification
- ✅ Transaction validation
- ✅ Amount limits ($1 - $10,000)
- ✅ User authentication required
- ✅ Database transaction consistency

## 7. Troubleshooting

### Common Issues

1. **PayPal buttons not showing**

   - Check if VITE_PAYPAL_CLIENT_ID is set correctly
   - Ensure you're using the sandbox Client ID for development

2. **Payment fails to capture**

   - Verify backend PAYPAL_CLIENT_SECRET is correct
   - Check server logs for PayPal API errors

3. **CORS errors**

   - Ensure FRONTEND_URL is set correctly in backend .env
   - Check that frontend is running on the specified URL

4. **Database connection issues**
   - Verify MONGODB_URI is correct
   - Ensure MongoDB is running

### Debug Mode

Enable debug logging by adding to backend .env:

```env
DEBUG=paypal:*
```

## 8. API Endpoints

### PayPal Integration Endpoints

- `POST /api/payments/paypal/create-order` - Create PayPal order
- `POST /api/payments/paypal/capture-payment` - Capture payment
- `GET /api/payments/wallet` - Get wallet information
- `GET /api/payments/transactions` - Get transaction history

## 9. Next Steps

After completing the PayPal setup, you can:

1. Add additional payment methods (Stripe, etc.)
2. Implement subscription payments
3. Add payment scheduling
4. Implement refund functionality
5. Add payment analytics and reporting

## Support

For PayPal-specific issues, refer to:

- [PayPal Developer Documentation](https://developer.paypal.com/docs/)
- [PayPal JavaScript SDK Reference](https://developer.paypal.com/docs/checkout/reference/server-integration/)
